<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Playground v20 ‚Äî Auto Theme Save</title>

<!-- Prism syntax highlight -->
<link id="prismTheme" rel="stylesheet">
<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
:root{
  --bg:#020617;--panel:#020617;--text:#e5e7eb;--accent:#2563eb;
  --console-bg:#111;--editor-bg:#0f172a;--editor-text:#22c55e;
}
body.light{
  --bg:#f1f5f9;--panel:#ffffff;--text:#111;
  --console-bg:#e2e8f0;--editor-bg:#e9eef4;--editor-text:#111;
}

body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:monospace;display:flex;justify-content:center;
  padding:10px;min-height:100vh;
}
.app{
  width:100%;max-width:900px;background:var(--panel);
  padding:12px;border-radius:12px;
}
.file-tabs{display:flex;gap:6px;overflow-x:auto;margin-bottom:10px}
.file-btn{
  padding:8px 12px;background:#334155;color:white;
  border-radius:8px;cursor:pointer;flex-shrink:0;
}
.file-btn.active{background:var(--accent)}

#editorBox{
  background:var(--editor-bg);color:var(--editor-text);
  border-radius:8px;padding:10px;min-height:320px;
  overflow-y:auto;white-space:pre;outline:none;
}

.buttons{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap}
button{
  flex:1;padding:10px;border:none;border-radius:8px;
  background:var(--accent);color:white;cursor:pointer;
}

.panel{
  background:var(--console-bg);margin-top:10px;padding:12px;
  border-radius:10px;height:220px;overflow-y:auto;font-size:14px;
  white-space:pre-wrap;color:var(--text);
}
.error{color:#ff5a5a;font-weight:bold}

#consoleFull{
  display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;
  background:black;color:white;z-index:9999;overflow:auto;padding:12px;
}
#consoleFullContent{white-space:pre-wrap}

#historyBox{
  display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;
  background:#000a;z-index:9999;padding:10px;overflow:auto;
}
#historyInner{
  background:#111;padding:10px;border-radius:10px;
  max-width:700px;margin:auto;margin-top:40px;color:white;
}
.history-item{
  padding:6px;margin:6px 0;background:#222;border-radius:6px;
  display:flex;justify-content:space-between;
}
.history-item button{
  padding:4px 8px;background:var(--accent);border:none;border-radius:4px;color:white;
}
</style>
</head>

<body>

<div class="app" id="editorArea">
<h2>Playground v20 ‚Äî Auto Theme Save</h2>

<!-- fixed beginner files -->
<div class="file-tabs">
  <div class="file-btn active" onclick="switchFile('index.html')">index.html</div>
  <div class="file-btn" onclick="switchFile('style.css')">style.css</div>
  <div class="file-btn" onclick="switchFile('script.js')">script.js</div>
</div>

<div id="editorBox" contenteditable="true"></div>

<div class="buttons">
  <button onclick="toggleTheme()">üåì Theme</button>
  <button onclick="runJS()">‚ñ∂ Run JS</button>
  <button onclick="showConsoleFull()">üñ• Console</button>
  <button onclick="showPreview()">üåê Preview</button>
  <button onclick="openHistory()">üìú JS History</button>
  <button onclick="downloadZip()">üì¶ ZIP</button>
</div>

<div id="consolePanel" class="panel"></div>
</div>

<!-- preview -->
<div id="previewArea" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:white;z-index:9999">
  <button onclick="hidePreview()" style="width:100%;padding:8px">üîô Back</button>
  <iframe id="previewFrame" style="width:100%;height:calc(100vh - 50px);border:none"></iframe>
</div>

<!-- full console -->
<div id="consoleFull">
  <button onclick="hideConsoleFull()" style="width:100%;padding:10px;">üîô Back</button>
  <pre id="consoleFullContent"></pre>
</div>

<!-- history -->
<div id="historyBox"><div id="historyInner"></div></div>

<script>
/* ========== THEME AUTO RESTORE ========== */
let savedTheme = localStorage.getItem("theme_v20") || "dark";
if(savedTheme === "light"){ document.body.classList.add("light"); }
document.getElementById("prismTheme").href =
 savedTheme==="light"
 ? "https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
 : "https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css";

/* ========== STORAGE ========== */
let files = JSON.parse(localStorage.getItem("files_v20")||"{}");
let historyList = JSON.parse(localStorage.getItem("hist_v20")||"[]");

if(Object.keys(files).length===0){
  files={
    "index.html":"<h1>Hello!</h1>",
    "style.css":"body{background:white;font-size:20px;}",
    "script.js":"console.log('JS Ready!')"
  }
}
function saveFiles(){localStorage.setItem("files_v20",JSON.stringify(files))}
function saveHist(){localStorage.setItem("hist_v20",JSON.stringify(historyList))}

let current="index.html";
const box=document.getElementById("editorBox");
const consolePanel=document.getElementById("consolePanel");

/* ========== EDITOR LOAD ========== */
function loadFile(){
  box.innerText = files[current];
  Prism.highlightElement(box);
}
loadFile();

function switchFile(name){
  files[current]=box.innerText;
  saveFiles();
  current=name;
  loadFile();
  document.querySelectorAll(".file-btn").forEach(b=>b.classList.remove("active"));
  [...document.querySelectorAll(".file-btn")].find(b=>b.innerText.includes(name)).classList.add("active");
}

/* ========== JS EXECUTION REAL CONSOLE ========== */
function clearConsolePanel(){consolePanel.innerHTML=""}
function addLog(type,msg){
  const div=document.createElement("div")
  div.className=type
  div.textContent=msg
  consolePanel.appendChild(div)
}

function runJS(){
  clearConsolePanel()
  historyList.push({t:new Date().toLocaleString(),js:files["script.js"]})
  saveHist()

  const frame=document.createElement("iframe")
  frame.style.display="none"
  document.body.appendChild(frame)
  const ctx=frame.contentWindow

  ctx.console.log=(...a)=>addLog("log",a.join(" "))
  ctx.console.error=(...a)=>addLog("error",a.join(" "))
  ctx.onerror=(msg,src,line,col,err)=>addLog("error",err?err.stack:msg)

  try{ ctx.eval(files["script.js"]) }
  catch(e){ addLog("error",e.stack) }

  document.body.removeChild(frame)
}

/* ========== PREVIEW ========== */
function showPreview(){
  const f=document.getElementById("previewFrame")
  f.srcdoc=`<html><head><style>${files["style.css"]}</style></head><body>${files["index.html"]}</body></html>`
  document.getElementById("previewArea").style.display="block"
  document.getElementById("editorArea").style.display="none"
}
function hidePreview(){
  document.getElementById("previewArea").style.display="none"
  document.getElementById("editorArea").style.display="block"
}

/* ========== FULL CONSOLE ========== */
function showConsoleFull(){
  document.getElementById("consoleFullContent").innerText = consolePanel.innerText
  document.getElementById("consoleFull").style.display="block"
}
function hideConsoleFull(){
  document.getElementById("consoleFull").style.display="none"
}

/* ========== HISTORY ========== */
function openHistory(){
  const h=document.getElementById("historyInner")
  h.innerHTML="<h3>JS History</h3>"
  historyList.forEach((item,i)=>{
    h.innerHTML+=`<div class='history-item'><span>${item.t}</span><button onclick='restoreHistory(${i})'>Load</button></div>`
  })
  document.getElementById("historyBox").style.display="block"
}
function restoreHistory(i){
  files["script.js"]=historyList[i].js
  saveFiles()
  if(current==="script.js") loadFile()
  alert("Restored script.js!")
}
document.getElementById("historyBox").onclick=e=>{
  if(e.target.id==="historyBox")e.target.style.display="none"
}

/* ========== ZIP ========== */
function downloadZip(){
  let zip=new JSZip()
  Object.keys(files).forEach(n=>zip.file(n,files[n]))
  zip.generateAsync({type:"blob"}).then(c=>{
    let a=document.createElement("a")
    a.href=URL.createObjectURL(c)
    a.download="project.zip"
    a.click()
  })
}

/* ========== THEME TOGGLE & SAVE ========== */
function toggleTheme(){
  const light=document.body.classList.toggle("light")
  localStorage.setItem("theme_v20", light?"light":"dark")
  document.getElementById("prismTheme").href =
    light
     ? "https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
     : "https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css"
  loadFile()
}
</script>
</body>
</html>
