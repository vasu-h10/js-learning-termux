<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Playground V13 ‚Äî CodeMirror + JSX/TSX + Fullscreen</title>

<!-- ‚ú® CodeMirror 6 (editor) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css" />
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js"></script>

<!-- üîç Syntax modes -->
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/javascript/javascript.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/xml/xml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/css/css.js"></script>

<!-- üé® Theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/monokai.css" />

<!-- ‚öõ JSX + TSX execution -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
:root {
  --bg:#020617;
  --panel:#020617;
  --text:#e5e7eb;
  --accent:#2563eb;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:monospace;
  padding:10px;
}

.app {
  max-width:1000px;
  margin:auto;
  background:var(--panel);
  padding:12px;
  border-radius:10px;
}

.file-tabs {
  display:flex;
  gap:6px;
  overflow-x:auto;
  padding-bottom:6px;
}

.file-btn {
  padding:8px 12px;
  background:#334155;
  border-radius:8px;
  color:white;
  cursor:pointer;
}
.file-btn.active { background:var(--accent); }

#console,#errors {
  background:black;
  padding:8px;
  border-radius:6px;
  font-size:14px;
  overflow-y:auto;
  height:150px;
}

.error {color:red;}
.log{color:white;}

button {
  padding:8px;
  border-radius:8px;
  background:var(--accent);
  color:white;
  border:none;
  cursor:pointer;
  margin:4px 0;
  width:100%;
}

#previewFull,#consoleFull {
  display:none;
  position:fixed;
  top:0;left:0;
  width:100vw;height:100vh;
  background:black;
  z-index:9999;
}

#previewFrame {
  width:100%;
  height:calc(100vh - 60px);
  border:none;
  background:white;
}
</style>
</head>

<body>
<div class="app" id="editorArea">
  <h2>Playground V13 ‚Äî CodeMirror + JSX + TSX</h2>

  <!-- üî§ Files -->
  <div class="file-tabs">
    <div class="file-btn active" onclick="switchFile('html')">index.html</div>
    <div class="file-btn" onclick="switchFile('css')">style.css</div>
    <div class="file-btn" onclick="switchFile('js')">script.js</div>
    <div class="file-btn" onclick="switchFile('jsx')">app.jsx</div>
    <div class="file-btn" onclick="switchFile('tsx')">app.tsx</div>
  </div>

  <!-- üìù Editor -->
  <textarea id="editor"></textarea>

  <!-- üß™ Buttons -->
  <button onclick="runCode()">‚ñ∂ Run</button>
  <button onclick="showPreviewFull()">üåç Full Preview</button>
  <button onclick="showConsoleFull()">üñ• Full Console</button>
  <button onclick="clearPanels()">üßπ Clear</button>

  <!-- üìå Output -->
  <h3>Console</h3>
  <div id="console"></div>

  <h3>Errors</h3>
  <div id="errors"></div>
</div>


<!-- ‚¨õ FULLSCREEN CONSOLE -->
<div id="consoleFull">
  <button onclick="hideConsoleFull()">üîô Back</button>
  <pre id="consoleFullBody" style="white-space:pre-wrap;color:white;"></pre>
</div>

<!-- üåê FULLSCREEN PREVIEW -->
<div id="previewFull">
  <button onclick="hidePreviewFull()">üîô Back</button>
  <iframe id="previewFrame"></iframe>
</div>


<script>
/* ================= DATA ================== */
let files = {
  html: localStorage.getItem("html") || "<h1>Hello JSX/TSX!</h1>",
  css: localStorage.getItem("css") || "h1{color:skyblue;}",
  js: localStorage.getItem("js") || "console.log('JS OK');",
  jsx: localStorage.getItem("jsx") || "function App(){ return <h2>Hello JSX!</h2> } App();",
  tsx: localStorage.getItem("tsx") || "function App():any{ return <h2>Hello TSX!</h2>} App();"
};

let curr = "html";

/* ========== EDITOR INIT =========== */
let cm = CodeMirror.fromTextArea(document.getElementById("editor"), {
  mode:"javascript",
  lineNumbers:true,
  theme:"monokai",
  tabSize:2,
});
cm.setValue(files[curr]);


/* ===== FILE SWITCH ===== */
function switchFile(ext){
  files[curr] = cm.getValue();
  curr = ext;
  cm.setValue(files[ext]);

  document.querySelectorAll(".file-btn").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".file-btn").forEach(btn=>{
    if(btn.innerText.includes(ext)) btn.classList.add("active");
  });
}


/* ===== CLEAR ===== */
function clearPanels(){
  consoleDiv.innerHTML="";
  errorsDiv.innerHTML="";
}
const consoleDiv = document.getElementById("console");
const errorsDiv = document.getElementById("errors");

function printLog(msg){ consoleDiv.innerHTML+=`<div class="log">${msg}</div>`; }
function printErr(msg){ errorsDiv.innerHTML+=`<div class="error">${msg}</div>`; }


/* ===== RUN ===== */
function runCode(){
  clearPanels();
  files[curr]=cm.getValue();

  let code = files["js"];
  let combined = "";

  if (files["jsx"]){
    try{ combined += Babel.transform(files["jsx"],{presets:["react"]}).code; }
    catch(e){ printErr("JSX Error: "+e.message); }
  }

  if (files["tsx"]){
    try{ combined += Babel.transform(files["tsx"],{presets:["react","typescript"]}).code; }
    catch(e){ printErr("TSX Error: "+e.message); }
  }

  code += "\n" + combined;

  try{
    let result = eval(code);
    if(result!==undefined) printLog("> "+result);
  } catch(e){
    printErr("JS Error: "+e.message);
  }
}


/* ===== PREVIEW ===== */
function generatePreview(){
  return `
  <html>
    <head><style>${files.css}</style></head>
    <body>${files.html}
    <script>
      try{
        ${files.js}
        ${Babel.transform(files.jsx,{presets:["react"]}).code}
        ${Babel.transform(files.tsx,{presets:["react","typescript"]}).code}
      }catch(e){
        document.body.innerHTML += '<pre style="color:red">'+e+'</pre>'
      }
    <\/script>
    </body>
  </html>`;
}

function showPreviewFull(){
  previewFull.style.display="block";
  previewFrame.srcdoc = generatePreview();
}
function hidePreviewFull(){ previewFull.style.display="none"; }


/* ===== CONSOLE FULL ===== */
function showConsoleFull(){
  consoleFull.style.display="block";
  consoleFullBody.innerText = consoleDiv.innerText + "\n" + errorsDiv.innerText;
}
function hideConsoleFull(){ consoleFull.style.display="none"; }
</script>
</body>
</html>
