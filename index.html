<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Playground v3</title>

<style>
:root {
  --bg: #020617;
  --panel: #020617;
  --text: #e5e7eb;
  --editor: #0f172a;
  --accent: #2563eb;
  --console-bg: #000;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: monospace;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px;
  min-height: 100vh;
}

.app {
  width: 100%;
  max-width: 900px;
  background: var(--panel);
  padding: 10px;
  border-radius: 12px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

select {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
  background: #334155;
  color: var(--text);
  border: none;
  font-size: 16px;
}

textarea {
  width: 100%;
  height: 280px;
  border-radius: 10px;
  margin-top: 10px;
  padding: 10px;
  font-size: 15px;
  background: var(--editor);
  color: #22c55e;
  resize: none;
  outline: none;
}

.buttons {
  margin-top: 10px;
  display: flex;
  gap: 8px;
}

.buttons button, #previewBtn, #backBtn {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: none;
  background: var(--accent);
  color: white;
  cursor: pointer;
  font-size: 16px;
}

.console {
  background: var(--console-bg);
  height: 200px;
  border-radius: 10px;
  padding: 10px;
  overflow-y: auto;
  margin-top: 10px;
  font-size: 14px;
}

#previewArea {
  display:none;
  width:100%;
  height:100vh;
  background:white;
  position:fixed;
  top:0;
  left:0;
  z-index:9999;
}

.error { color:red; }
.log { color:white; }
</style>
</head>

<body>
<div class="app" id="editorArea">
  <header>
    <h2>Playground v3</h2>
  </header>

  <select id="fileSelect" onchange="switchFile()">
    <option value="html">index.html</option>
    <option value="css">style.css</option>
    <option value="js">script.js</option>
  </select>

  <textarea id="editor"></textarea>

  <div class="buttons">
    <button onclick="runCode()">‚ñ∂ Run</button>
    <button onclick="clearConsole()">üßπ Clear</button>
  </div>

  <div id="console" class="console"></div>

  <button id="previewBtn" onclick="showPreview()">üåê Preview Full Screen</button>
</div>

<div id="previewArea">
  <button id="backBtn" onclick="hidePreview()" style="width:100%;border-radius:0;">üîô Back to Editor</button>
  <iframe id="iframe" style="width:100%;height:calc(100vh - 50px);border:none;"></iframe>
</div>

<script>
let files = {
  html: localStorage.getItem("html") || "<h1>Hello Playground</h1>",
  css:  localStorage.getItem("css")  || "h1{color:green;}",
  js:   localStorage.getItem("js")   || "console.log('JS OK');"
};

const editor = document.getElementById("editor");
const consoleBox = document.getElementById("console");
const fileSelect = document.getElementById("fileSelect");

function switchFile(){
  files[fileSelect.value] = editor.value;
  editor.value = files[fileSelect.value];
}
editor.value = files[fileSelect.value];

editor.addEventListener("input",()=>{
  files[fileSelect.value] = editor.value;
  localStorage.setItem(fileSelect.value, editor.value);
});

function clearConsole(){
  consoleBox.innerHTML="";
}

/* üîç detect CSS errors */
function validateCSS(css){
  try{
    const sheet = new CSSStyleSheet();
    sheet.replaceSync(css);
  }catch(e){
    consoleBox.innerHTML += `<div class="error">CSS Error: ${e.message}</div>`;
  }
}

/* üîç detect HTML issues */
function validateHTML(html){
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, "text/html");
  const errors = doc.querySelectorAll("parsererror");
  errors.forEach(e=>{
    consoleBox.innerHTML += `<div class="error">HTML Error: ${e.textContent}</div>`;
  });
}

/* üß† Run JS with try-catch */
function runCode(){
  clearConsole();
  validateHTML(files.html);
  validateCSS(files.css);

  try{
    const result = eval(files.js);
    if(result!==undefined){
      consoleBox.innerHTML += `<div class="log">&gt; ${result}</div>`;
    }
  }catch(e){
    consoleBox.innerHTML += `<div class="error">JS Error: ${e.message}</div>`;
  }
}

/* üåê Preview combine auto */
function showPreview(){
  files[fileSelect.value]=editor.value;
  const iframe = document.getElementById("iframe");
  const doc = iframe.contentDocument || iframe.contentWindow.document;

  doc.open();
  doc.write(`
    <html>
      <head><style>${files.css}</style></head>
      <body>${files.html}
      <script>
        try{ ${files.js} }
        catch(e){ document.body.innerHTML += '<pre style="color:red">'+e+'</pre>' }
      <\/script>
      </body>
    </html>
  `);
  doc.close();
  document.getElementById("previewArea").style.display="block";
  document.getElementById("editorArea").style.display="none";
}

/* üîô Back */
function hidePreview(){
  document.getElementById("previewArea").style.display="none";
  document.getElementById("editorArea").style.display="block";
}
</script>
</body>
</html>
