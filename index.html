<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Playground v20 ‚Äî Beginner + Theme</title>

<!-- Prism Syntax Highlight -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="theme-dark">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="theme-light" disabled>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
:root {
  --accent:#2563eb;
}
body {
  margin:0;
  font-family:monospace;
  padding:10px;
  display:flex;
  justify-content:center;
  min-height:100vh;
}
body[data-theme="dark"] {
  background:#020617;
  color:#e5e7eb;
}
body[data-theme="light"] {
  background:#f4f4f4;
  color:#222;
}
.app {
  width:100%;
  max-width:900px;
  background:rgba(0,0,0,.2);
  border-radius:12px;
  padding:12px;
}
.file-tabs {
  display:flex;gap:6px;overflow-x:auto;margin-bottom:8px;
}
.file-btn {
  padding:8px 12px;
  background:#334155;
  border-radius:8px;
  cursor:pointer;
  white-space:nowrap;
}
.file-btn.active { background:var(--accent); }

textarea {
  width:100%;
  height:260px;
  border-radius:8px;
  padding:10px;
  font-size:14px;
  outline:none;
  border:1px solid #475569;
  background:transparent;
  color:inherit;
  caret-color:var(--accent);
  resize:none;
}

pre { margin:0;padding:0; }

.buttons {
  display:flex;gap:6px;margin-top:10px;flex-wrap:wrap;
}
button {
  flex:1;
  padding:10px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:white;
  cursor:pointer;
}

.panel {
  margin-top:8px;
  background:#000;
  padding:12px;
  border-radius:10px;
  height:200px;
  overflow-y:auto;
  font-size:14px;
}
.log{color:#fff;}
.error{color:red;}

#previewArea {
  display:none;position:fixed;top:0;left:0;
  width:100%;height:100%;background:white;z-index:9999;
}
#previewFrame {
  width:100%;height:calc(100vh - 50px);border:none;
}
#consoleFull {
  display:none;position:fixed;top:0;left:0;
  width:100%;height:100%;background:#000;color:#fff;z-index:9999;
}
#consoleFullContent { white-space:pre-wrap; }

#themeBtn {
  position:absolute;top:10px;right:10px;
  padding:6px 12px;border-radius:6px;
  background:var(--accent);color:white;
}
</style>
</head>

<body>

<button id="themeBtn" onclick="toggleTheme()">üåó Theme</button>

<div class="app" id="editorArea">
<h2>Playground v20 ‚Äî HTML / CSS / JS</h2>

<div class="file-tabs">
<div class="file-btn active" onclick="switchFile('index.html')">index.html</div>
<div class="file-btn" onclick="switchFile('style.css')">style.css</div>
<div class="file-btn" onclick="switchFile('script.js')">script.js</div>
</div>

<textarea id="editor"></textarea>
<pre><code id="highlighted" class="language-markup"></code></pre>

<div class="buttons">
<button onclick="runJS()">‚ñ∂ Run JS</button>
<button onclick="showPreviewFull()">üåê Preview</button>
<button onclick="showConsoleFull()">üñ• Console</button>
<button onclick="openHistory()">üìú History</button>
<button onclick="downloadZip()">üì¶ Download</button>
</div>

<div id="jsPanel" class="panel"></div>
</div>

<div id="previewArea">
<button onclick="hidePreview()" style="width:100%;">üîô Back</button>
<iframe id="previewFrame"></iframe>
</div>

<div id="consoleFull">
<button onclick="hideConsoleFull()">üîô Back</button>
<pre id="consoleFullContent"></pre>
</div>

<script>
let files = JSON.parse(localStorage.getItem("files_v20")||"{}");
let hist  = JSON.parse(localStorage.getItem("hist_v20")||"[]");

if(Object.keys(files).length===0){
  files={
    "index.html":"<h1>Hello!</h1>",
    "style.css":"body{background:white;}",
    "script.js":"console.log('JS OK')"
  };
}

let current="index.html";
let editor=document.getElementById("editor");
let highlighted=document.getElementById("highlighted");

function save(){localStorage.setItem("files_v20",JSON.stringify(files))}
function saveHist(){localStorage.setItem("hist_v20",JSON.stringify(hist))}

/* update highlight */
function refreshHighlight(){
  highlighted.textContent = files[current];
  highlighted.className="language-" +
    (current.endsWith(".js")?"javascript":current.endsWith(".css")?"css":"markup");
  Prism.highlightElement(highlighted);
}

/* setup */
editor.value = files[current];
editor.addEventListener("input", ()=>{
  files[current]=editor.value;
  save();
  refreshHighlight();
});
refreshHighlight();

/* theme */
function toggleTheme(){
  let b=document.documentElement;
  let d=document.getElementById("theme-dark");
  let l=document.getElementById("theme-light");

  if(b.getAttribute("data-theme")==="dark"){
    b.setAttribute("data-theme","light");
    d.disabled=true; l.disabled=false;
  } else {
    b.setAttribute("data-theme","dark");
    d.disabled=false; l.disabled=true;
  }
  localStorage.setItem("theme_v20",b.getAttribute("data-theme"));
}

let savedTheme=localStorage.getItem("theme_v20");
if(savedTheme){
  document.documentElement.setAttribute("data-theme",savedTheme);
  if(savedTheme==="light"){themeBtn.click();}
}

/* file switch */
function switchFile(n){
  files[current]=editor.value;save();
  current=n;
  editor.value=files[n];
  refreshHighlight();
  document.querySelectorAll(".file-btn").forEach(b=>b.classList.remove("active"));
  [...document.querySelectorAll(".file-btn")].find(b=>b.innerText.includes(n)).classList.add("active");
}

/* run JS */
function runJS(){
  let p=document.getElementById("jsPanel");p.innerHTML="";
  try{
    let r=eval(files["script.js"]);
    if(r!==undefined)p.innerHTML+=`<div class="log">${r}</div>`;
  }catch(e){
    p.innerHTML=`<div class="error">${e.message}</div>`;
  }
  hist.push({t:new Date().toLocaleString(), snap:JSON.stringify(files)});saveHist();
}

/* preview */
function showPreviewFull(){
  let f=document.getElementById("previewFrame");
  f.srcdoc=`<html><head><style>${files["style.css"]}</style></head>
  <body>${files["index.html"]}
  <script>try{${files["script.js"]}}catch(e){document.body.innerHTML+='<pre style="color:red">'+e+'</pre>'}<\/script>
  </body></html>`;
  document.getElementById("previewArea").style.display="block";
  document.getElementById("editorArea").style.display="none";
}
function hidePreview(){
  document.getElementById("previewArea").style.display="none";
  document.getElementById("editorArea").style.display="block";
}

/* full console */
function showConsoleFull(){
  document.getElementById("consoleFullContent").innerText=document.getElementById("jsPanel").innerText;
  document.getElementById("consoleFull").style.display="block";
}
function hideConsoleFull(){
  document.getElementById("consoleFull").style.display="none";
}

/* history */
function openHistory(){
  let div=document.getElementById("jsPanel");
  div.innerHTML="--- HISTORY ---<br>";
  hist.slice().reverse().forEach(h=>{
    div.innerHTML+=`${h.t}<br>`;
  });
}

/* download */
function downloadZip(){
  let z=new JSZip();
  Object.keys(files).forEach(n=>z.file(n,files[n]));
  z.generateAsync({type:"blob"}).then(c=>{
    let a=document.createElement("a");
    a.href=URL.createObjectURL(c);
    a.download="project.zip";
    a.click();
  });
}
</script>
</body>
</html>
